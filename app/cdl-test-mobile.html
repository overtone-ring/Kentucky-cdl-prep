<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Kentucky CDL Practice Test</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary: #1a73e8;
    --primary-dark: #1557b0;
    --success: #34a853;
    --danger: #ea4335;
    --warning: #fbbc04;
    --bg: #f8f9fa;
    --card: #ffffff;
    --text: #202124;
    --text-secondary: #5f6368;
    --border: #dadce0;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    line-height: 1.5;
}

.screen {
    display: none;
    min-height: 100vh;
    padding: 20px;
    padding-bottom: env(safe-area-inset-bottom, 20px);
}

.screen.active {
    display: block;
}

#home-screen {
    padding-top: 60px;
    text-align: center;
}

.header h1 {
    font-size: 2.5rem;
    color: var(--primary);
    font-weight: 700;
}

.header h2 {
    font-size: 1.5rem;
    color: var(--text-secondary);
    font-weight: 400;
    margin-top: 5px;
}

.subtitle {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 10px;
    margin-bottom: 20px;
}

.manual-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background: var(--card);
    border: 2px solid var(--primary);
    border-radius: 25px;
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.95rem;
    margin-bottom: 30px;
    transition: all 0.2s ease;
}

.manual-link:hover {
    background: var(--primary);
    color: white;
}

.manual-icon {
    font-size: 1.2rem;
}

.test-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
    max-width: 400px;
    margin: 0 auto;
}

.test-btn {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    background: var(--card);
    border: 2px solid var(--border);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 1rem;
}

.test-btn:hover, .test-btn:active {
    border-color: var(--primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.test-name {
    font-weight: 600;
    color: var(--text);
}

.test-info {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.mode-toggle {
    margin-top: 30px;
    padding: 15px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
}

.mode-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.mode-option {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 10px;
    padding: 15px;
    background: var(--card);
    border: 2px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.mode-option:has(input:checked) {
    border-color: var(--primary);
    background: #e8f0fe;
}

.mode-option input {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.mode-name {
    font-weight: 600;
    color: var(--text);
}

.mode-desc {
    width: 100%;
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-left: 28px;
}

.stats-summary {
    margin-top: 30px;
    padding: 20px;
    background: var(--card);
    border-radius: 12px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
    text-align: left;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.stats-summary h3 {
    color: var(--text);
    margin-bottom: 10px;
    font-size: 1rem;
}

.stats-summary .stat-row {
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
    border-bottom: 1px solid var(--border);
}

.stats-summary .stat-row:last-child {
    border-bottom: none;
}

.test-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    margin-bottom: 15px;
}

.back-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--primary);
    padding: 5px 10px;
}

.test-title {
    font-weight: 600;
    font-size: 1.1rem;
}

.progress {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.progress-bar {
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    margin-bottom: 25px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: var(--primary);
    border-radius: 3px;
    transition: width 0.3s ease;
    width: 0%;
}

.question-container {
    background: var(--card);
    border-radius: 16px;
    padding: 25px 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.question-number {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-bottom: 10px;
}

.question-text {
    font-size: 1.15rem;
    font-weight: 500;
    margin-bottom: 25px;
    line-height: 1.6;
}

.choices {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.choice-btn {
    display: flex;
    align-items: flex-start;
    padding: 16px 18px;
    background: var(--bg);
    border: 2px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    text-align: left;
    font-size: 1rem;
    line-height: 1.5;
    transition: all 0.2s ease;
    color: var(--text);
}

.choice-btn:hover:not(.disabled) {
    border-color: var(--primary);
    background: #e8f0fe;
}

.choice-btn.selected {
    border-color: var(--primary);
    background: #e8f0fe;
}

.choice-btn.correct {
    border-color: var(--success);
    background: #e6f4ea;
}

.choice-btn.incorrect {
    border-color: var(--danger);
    background: #fce8e6;
}

.choice-btn.disabled {
    cursor: default;
}

.choice-letter {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    min-width: 28px;
    border-radius: 50%;
    background: var(--border);
    color: var(--text);
    font-weight: 600;
    font-size: 0.85rem;
    margin-right: 12px;
}

.choice-btn.selected .choice-letter {
    background: var(--primary);
    color: white;
}

.choice-btn.correct .choice-letter {
    background: var(--success);
    color: white;
}

.choice-btn.incorrect .choice-letter {
    background: var(--danger);
    color: white;
}

.choice-text {
    flex: 1;
    padding-top: 3px;
}

.explanation {
    margin-top: 20px;
    padding: 18px;
    background: #e8f0fe;
    border-radius: 10px;
    border-left: 4px solid var(--primary);
    font-size: 0.95rem;
    line-height: 1.6;
}

.explanation.hidden {
    display: none;
}

.explanation.visible {
    display: block;
}

.explanation-title {
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 8px;
}

.manual-ref {
    display: inline-block;
    margin-top: 15px;
    padding: 10px 16px;
    background: var(--primary);
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.2s ease;
}

.manual-ref:hover {
    background: var(--primary-dark);
    transform: translateY(-1px);
}

.nav-buttons {
    display: flex;
    gap: 12px;
    margin-top: 25px;
}

.nav-btn {
    flex: 1;
    padding: 14px 20px;
    border: 2px solid var(--border);
    border-radius: 10px;
    background: var(--card);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--text);
}

.nav-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.nav-btn.primary {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
}

.nav-btn.primary:hover:not(:disabled) {
    background: var(--primary-dark);
}

.results-container {
    max-width: 400px;
    margin: 0 auto;
    text-align: center;
    padding-top: 40px;
}

.results-header h2 {
    font-size: 1.8rem;
    margin-bottom: 30px;
}

.score-circle {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    background: var(--card);
    border: 8px solid var(--success);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 0 auto 30px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.score-circle.fail {
    border-color: var(--danger);
}

.score-percent {
    font-size: 3rem;
    font-weight: 700;
    color: var(--text);
}

.score-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.results-details {
    background: var(--card);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
}

.result-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
}

.result-row:last-child {
    border-bottom: none;
}

.pass-fail {
    font-size: 1.5rem;
    font-weight: 700;
    padding: 15px 30px;
    border-radius: 10px;
    margin-bottom: 30px;
}

.pass-fail.passed {
    background: #e6f4ea;
    color: var(--success);
}

.pass-fail.failed {
    background: #fce8e6;
    color: var(--danger);
}

.results-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.action-btn {
    padding: 16px 30px;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    background: var(--primary);
    color: white;
    transition: all 0.2s ease;
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.action-btn.secondary {
    background: var(--card);
    color: var(--text);
    border: 2px solid var(--border);
}

.question-status {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 15px;
}

.question-status.correct {
    background: #e6f4ea;
    color: var(--success);
}

.question-status.incorrect {
    background: #fce8e6;
    color: var(--danger);
}

.review-choices .choice-btn {
    cursor: default;
}

@media (max-width: 400px) {
    .screen {
        padding: 15px;
    }
    .header h1 {
        font-size: 2rem;
    }
    .question-text {
        font-size: 1.05rem;
    }
    .choice-btn {
        padding: 14px 15px;
        font-size: 0.95rem;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --bg: #1a1a1a;
        --card: #2d2d2d;
        --text: #e8eaed;
        --text-secondary: #9aa0a6;
        --border: #5f6368;
    }
    .choice-btn {
        color: var(--text);
    }
    .choice-btn:hover:not(.disabled) {
        background: #3c4043;
    }
    .choice-btn.selected {
        background: #174ea6;
    }
    .choice-btn.correct {
        background: #137333;
    }
    .choice-btn.incorrect {
        background: #a50e0e;
    }
    .explanation {
        background: #174ea6;
        color: #e8eaed;
    }
    .nav-btn {
        color: var(--text);
    }
    .mode-option:has(input:checked) {
        background: #174ea6;
    }
}
    </style>
</head>
<body>
    <div id="app">
        <div id="home-screen" class="screen active">
            <div class="header">
                <h1>Kentucky CDL</h1>
                <h2>Practice Test</h2>
            </div>
            <div class="subtitle">Based on the Official KY CDL Manual</div>
            <div class="test-options">
                <button class="test-btn" data-test="generalKnowledge">
                    <span class="test-name">General Knowledge</span>
                    <span class="test-info">50 Questions</span>
                </button>
                <button class="test-btn" data-test="airBrakes">
                    <span class="test-name">Air Brakes</span>
                    <span class="test-info">25 Questions</span>
                </button>
                <button class="test-btn" data-test="passenger">
                    <span class="test-name">Passenger</span>
                    <span class="test-info">20 Questions</span>
                </button>
                <button class="test-btn" data-test="schoolBus">
                    <span class="test-name">School Bus</span>
                    <span class="test-info">20 Questions</span>
                </button>
                <button class="test-btn" data-test="vehicleInspection">
                    <span class="test-name">Pre-Trip Inspection</span>
                    <span class="test-info">30 Questions</span>
                </button>
                <button class="test-btn" data-test="combinationVehicles">
                    <span class="test-name">Combination Vehicles</span>
                    <span class="test-info">25 Questions</span>
                </button>
                <button class="test-btn" data-test="doublesTriples">
                    <span class="test-name">Doubles/Triples</span>
                    <span class="test-info">20 Questions</span>
                </button>
                <button class="test-btn" data-test="tankVehicles">
                    <span class="test-name">Tank Vehicles</span>
                    <span class="test-info">15 Questions</span>
                </button>
                <button class="test-btn" data-test="hazardousMaterials">
                    <span class="test-name">Hazardous Materials</span>
                    <span class="test-info">25 Questions</span>
                </button>
            </div>
            <div class="mode-toggle">
                <div class="mode-options">
                    <label class="mode-option">
                        <input type="radio" name="test-mode" value="practice" checked>
                        <span class="mode-name">Practice Mode</span>
                        <span class="mode-desc">See right/wrong after each question</span>
                    </label>
                    <label class="mode-option">
                        <input type="radio" name="test-mode" value="test">
                        <span class="mode-name">Test Mode</span>
                        <span class="mode-desc">No feedback until the end (like real test)</span>
                    </label>
                </div>
            </div>
            <div class="stats-summary" id="stats-summary"></div>
        </div>

        <div id="test-screen" class="screen">
            <div class="test-header">
                <button class="back-btn" id="back-btn">&larr;</button>
                <span class="test-title" id="test-title">General Knowledge</span>
                <span class="progress" id="progress">1/50</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="question-container">
                <div class="question-number" id="question-number">Question 1</div>
                <div class="question-text" id="question-text"></div>
                <div class="choices" id="choices"></div>
                <div class="explanation hidden" id="explanation"></div>
                <div class="nav-buttons">
                    <button class="nav-btn" id="prev-btn" disabled>Previous</button>
                    <button class="nav-btn primary" id="next-btn">Next</button>
                </div>
            </div>
        </div>

        <div id="results-screen" class="screen">
            <div class="results-container">
                <div class="results-header">
                    <h2 id="results-title">Test Complete!</h2>
                </div>
                <div class="score-circle" id="score-circle">
                    <span class="score-percent" id="score-percent">0%</span>
                    <span class="score-label">Score</span>
                </div>
                <div class="results-details">
                    <div class="result-row">
                        <span>Correct Answers:</span>
                        <span id="correct-count">0</span>
                    </div>
                    <div class="result-row">
                        <span>Incorrect Answers:</span>
                        <span id="incorrect-count">0</span>
                    </div>
                    <div class="result-row">
                        <span>Passing Score:</span>
                        <span>80%</span>
                    </div>
                </div>
                <div class="pass-fail" id="pass-fail">PASSED</div>
                <div class="results-actions">
                    <button class="action-btn" id="review-btn">Review Answers</button>
                    <button class="action-btn" id="retake-btn">Retake Test</button>
                    <button class="action-btn secondary" id="home-btn">Back to Menu</button>
                </div>
            </div>
        </div>

        <div id="review-screen" class="screen">
            <div class="test-header">
                <button class="back-btn" id="review-back-btn">&larr;</button>
                <span class="test-title">Review Answers</span>
                <span class="progress" id="review-progress">1/50</span>
            </div>
            <div class="question-container">
                <div class="question-status" id="review-status"></div>
                <div class="question-number" id="review-question-number">Question 1</div>
                <div class="question-text" id="review-question-text"></div>
                <div class="choices review-choices" id="review-choices"></div>
                <div class="explanation visible" id="review-explanation"></div>
                <div class="nav-buttons">
                    <button class="nav-btn" id="review-prev-btn">Previous</button>
                    <button class="nav-btn" id="review-next-btn">Next</button>
                </div>
            </div>
        </div>
    </div>

<script>
// Manual page mapping - PDF page numbers for each section
const SECTION_PAGES = {
    generalKnowledge: { start: 28, name: "Section 2 - Driving Safely" },
    airBrakes: { start: 80, name: "Section 5 - Air Brakes" },
    passenger: { start: 76, name: "Section 4 - Transporting Passengers" },
    schoolBus: { start: 132, name: "Section 10 - School Buses" }
};

const QUESTIONS_DATA = {"generalKnowledge":{"name":"General Knowledge","requiredScore":80,"questionCount":50,"questions":[{"id":"gk1","question":"At 55 mph on dry pavement with good brakes, the total stopping distance for a heavy vehicle is approximately:","choices":["200 feet","300 feet","Over 400 feet","100 feet"],"correct":2,"explanation":"At 55 mph, your vehicle will travel a minimum of 419 feet to come to a complete stop."},{"id":"gk2","question":"When driving, you should look at least how far ahead?","choices":["5 to 8 seconds","12 to 15 seconds","20 to 25 seconds","3 to 5 seconds"],"correct":1,"explanation":"Look at least 12 to 15 seconds ahead. That means looking ahead the distance you will travel in 12 to 15 seconds."},{"id":"gk3","question":"How far ahead does 12 to 15 seconds represent at lower speeds?","choices":["About half a block","About one block","About two blocks","About 50 feet"],"correct":1,"explanation":"At lower speeds, looking 12 to 15 seconds ahead is about one block."},{"id":"gk4","question":"If you double your speed from 20 to 40 mph, the impact in a crash will be:","choices":["2 times greater","4 times greater","8 times greater","The same"],"correct":1,"explanation":"When you double your speed from 20 to 40 mph, the impact is 4 times greater."},{"id":"gk5","question":"Hydroplaning can occur at speeds as low as:","choices":["55 mph","45 mph","30 mph","65 mph"],"correct":2,"explanation":"Hydroplaning can occur at speeds as low as 30 mph if there is a lot of water."},{"id":"gk6","question":"On a two-lane road, how far from the vehicle should you place the rearmost warning device when stopped?","choices":["100 feet","200 feet","300 feet","50 feet"],"correct":1,"explanation":"On a two-lane road, place warning devices 10 feet, 100 feet, and 200 feet toward approaching traffic."},{"id":"gk7","question":"During your trip, how often should you check your cargo?","choices":["Only at the start","Every 3 hours or 150 miles","Every 6 hours or 300 miles","Only if you hear something shift"],"correct":1,"explanation":"Check cargo within the first 50 miles after beginning a trip and every 150 miles or every three hours thereafter."},{"id":"gk8","question":"At 55 mph, perception distance (the distance traveled while recognizing a hazard) is approximately:","choices":["61 feet","142 feet","216 feet","32 feet"],"correct":1,"explanation":"The average perception time is 1 3/4 seconds (1.75 seconds). At 55 mph this accounts for 142 feet traveled."},{"id":"gk9","question":"At 55 mph, reaction distance (the distance traveled while moving your foot to the brake) is approximately:","choices":["142 feet","32 feet","61 feet","216 feet"],"correct":2,"explanation":"Reaction Distance is the distance traveled during reaction time (3/4 to 1 second). At 55 mph this accounts for 61 feet."},{"id":"gk10","question":"What is the proper following distance rule for vehicles under 40 mph?","choices":["2 seconds regardless of vehicle length","1 second for every 10 feet of vehicle length","5 seconds for all vehicles","3 seconds for all vehicles"],"correct":1,"explanation":"Allow at least one second for each 10 feet of vehicle length at speeds below 40 mph."},{"id":"gk11","question":"At speeds over 40 mph, what additional following distance should you add?","choices":["No additional time needed","Add 1 second","Add 3 seconds","Double the distance"],"correct":1,"explanation":"At speeds over 40 mph, you should add 1 second to your following distance."},{"id":"gk12","question":"When should you downshift for a curve?","choices":["While in the curve","Before entering the curve","After exiting the curve","Only on wet roads"],"correct":1,"explanation":"You should slow down before entering a curve. Downshift before entering the curve - never while in it."},{"id":"gk13","question":"What is the best way to check that your service brakes are working properly?","choices":["Listen for air leaks","Wait for the low air warning","Apply firm pressure while moving slowly and note if vehicle pulls to one side","Check the brake pedal height"],"correct":2,"explanation":"Move the vehicle forward slowly and apply the brakes firmly. Note any vehicle pulling to one side, unusual feel, or delayed stopping action."},{"id":"gk14","question":"When testing hydraulic brakes, you should hold the brake pedal down for how long to check for leaks?","choices":["3 seconds","5 seconds","10 seconds","15 seconds"],"correct":1,"explanation":"With the engine running, apply firm pressure to the brake pedal for 5 seconds. The pedal should not move."},{"id":"gk15","question":"If you triple your speed from 20 to 60 mph, how much greater is the impact and braking distance?","choices":["3 times greater","6 times greater","9 times greater","12 times greater"],"correct":2,"explanation":"Triple the speed from 20 to 60 mph and the impact and braking distance is 9 times greater."},{"id":"gk16","question":"What is the minimum tread depth for front tires?","choices":["2/32 inch","4/32 inch","1/32 inch","6/32 inch"],"correct":1,"explanation":"Front tires must have tread depth of at least 4/32 inch."},{"id":"gk17","question":"What is the minimum tread depth for other tires?","choices":["4/32 inch","2/32 inch","1/32 inch","3/32 inch"],"correct":1,"explanation":"Other tires must have tread depth of at least 2/32 inch."},{"id":"gk18","question":"When backing a vehicle, you should:","choices":["Back quickly to get it over with","Back toward the driver's side whenever possible","Always use the passenger side for better visibility","Rely solely on mirrors"],"correct":1,"explanation":"Back to the driver's side so that you can see better. Backing toward the right side is very dangerous because you can't see as well."},{"id":"gk19","question":"Why should you avoid backing toward the passenger side?","choices":["It's easier to back toward the driver's side","You cannot see as well","The turning radius is different","It's harder on the transmission"],"correct":1,"explanation":"Backing toward the right (passenger) side is very dangerous because you can't see as well."},{"id":"gk20","question":"Which of the following is a leading cause of serious vehicle fires?","choices":["Electrical problems","Fuel leaks","Smoking near the vehicle","Engine overheating"],"correct":1,"explanation":"Fuel leaking around the engine is a leading cause of vehicle fires. Spilled fuel, loose fuel connections, and improper fueling are all fire hazards."},{"id":"gk21","question":"If you are driving in fog, you should use:","choices":["High beam headlights","Low beam headlights","Parking lights only","No lights"],"correct":1,"explanation":"In fog, use low beams. High beams reflect off the fog and reduce visibility."},{"id":"gk22","question":"When driving in slippery conditions, how much more following distance should you allow?","choices":["Double the normal distance","Triple the normal distance","Add one second","Same as normal"],"correct":0,"explanation":"When roads are slippery, you need more distance to stop, so slow down and increase following distance."},{"id":"gk23","question":"What is the proper way to use engine braking on a long downgrade?","choices":["Stay in high gear and use the brakes constantly","Use a low gear before starting down and apply brakes only to prevent speeding","Apply brakes at the top and coast down","Alternate between high and low gear"],"correct":1,"explanation":"The use of brakes on a long and/or steep downgrade is only a supplement to the braking effect of the engine."},{"id":"gk24","question":"What is 'brake fade'?","choices":["Normal wear of brake pads","Brakes losing effectiveness due to overheating","Brakes getting wet","Low brake fluid"],"correct":1,"explanation":"Brake fade is caused by excessive heat from using brakes too much without relying on engine braking, causing chemical changes in brake linings and drum expansion."},{"id":"gk25","question":"When driving in very hot weather, you should inspect your tires every:","choices":["200 miles or 4 hours","150 miles or 3 hours","100 miles or 2 hours","50 miles or 1 hour"],"correct":2,"explanation":"In very hot weather, check tires every 2 hours or every 100 miles to monitor for proper inflation and overheating."},{"id":"gk26","question":"What class CDL is required for any combination of vehicles with a GCWR of 26,001 pounds or more (if towed vehicle is over 10,000 pounds)?","choices":["Class C","Class B","Class A","No CDL required"],"correct":2,"explanation":"Class A CDL is required for any combination of vehicles with a GCWR of 26,001 pounds or more, provided the GVWR of the vehicle being towed is in excess of 10,000 pounds."},{"id":"gk27","question":"What class CDL is required for any single vehicle with a GVWR of 26,001 pounds or more?","choices":["Class A","Class B","Class C","No CDL required"],"correct":1,"explanation":"Class B CDL is required for any single vehicle with a GVWR of 26,001 pounds or more."},{"id":"gk28","question":"To pass the CDL knowledge test, you must answer what percentage of questions correctly?","choices":["70 percent","75 percent","80 percent","90 percent"],"correct":2,"explanation":"For each test, 80 percent of the questions must be answered correctly to pass."},{"id":"gk29","question":"How long must you hold a CDL instruction permit before taking the skills test?","choices":["7 days","14 days","30 days","No waiting period"],"correct":1,"explanation":"The permit must be held for 14 days prior to a skills test being administered."},{"id":"gk30","question":"What BAC level will result in being put out of service for 24 hours when driving a commercial vehicle?","choices":[".04% or higher","Any amount from .01% to .039%",".08% or higher",".02% or higher"],"correct":1,"explanation":"If a driver tests from .01% BAC to .039% BAC, that driver shall be put out of service for 24 hours."},{"id":"gk31","question":"What BAC level results in disqualification from commercial driving for one year (first offense)?","choices":[".02% or higher",".04% or higher",".08% or higher",".10% or higher"],"correct":1,"explanation":"Drivers testing at .04% BAC or higher will be disqualified for one year."},{"id":"gk32","question":"A second conviction for DUI while driving a commercial motor vehicle results in:","choices":["1 year disqualification","3 year disqualification","5 year disqualification","Lifetime disqualification"],"correct":3,"explanation":"A second conviction of driving a commercial motor vehicle under the influence of alcohol or other drugs results in lifetime disqualification."},{"id":"gk33","question":"How many serious traffic violations in three years results in a 60-day disqualification?","choices":["One","Two","Three","Four"],"correct":1,"explanation":"Two serious moving violations in three years results in 60 days disqualification."},{"id":"gk34","question":"How many serious traffic violations in three years results in a 120-day disqualification?","choices":["One","Two","Three","Four"],"correct":2,"explanation":"Three serious moving violations in three years results in 120 days disqualification."},{"id":"gk35","question":"Which is considered a 'serious violation'?","choices":["Speeding 5 mph over the limit","Speeding 15 mph or more over the limit","Failure to signal","Expired registration"],"correct":1,"explanation":"A serious violation includes speeding 15 mph or more, improper lane usage/changes, following too closely, reckless driving."},{"id":"gk36","question":"When should you use your horn?","choices":["To express frustration at other drivers","To let other drivers know you're there when necessary","Frequently to keep other drivers alert","Only in emergencies"],"correct":1,"explanation":"Use your horn to let others know you're there when needed, but avoid using it unnecessarily."},{"id":"gk37","question":"What is the minimum number of tie-downs required for any flatbed load?","choices":["One","Two","Three","Four"],"correct":1,"explanation":"There should be at least one tie-down for each 10 feet of cargo, with a minimum of two tie-downs."},{"id":"gk38","question":"What is the minimum number of tie-downs for a 20-foot load?","choices":["One","Two","Three","Four"],"correct":1,"explanation":"A 20-foot load requires a minimum of two tie-downs (one for each 10 feet)."},{"id":"gk39","question":"Cargo should be checked within the first how many miles of starting a trip?","choices":["25 miles","50 miles","100 miles","150 miles"],"correct":1,"explanation":"Check cargo within the first 50 miles after beginning a trip."},{"id":"gk40","question":"What is the main reason for covering cargo on an open bed?","choices":["To make the load look nicer","To protect the cargo and prevent it from falling","To reduce wind resistance","It's not necessary to cover cargo"],"correct":1,"explanation":"You should cover cargo to protect the cargo from weather and to prevent it from falling or blowing off."},{"id":"gk41","question":"What should you do before transporting a sealed load?","choices":["Nothing special is required","Check that you do not exceed weight limits","Open and inspect all cargo","Contact the shipper"],"correct":1,"explanation":"Before transporting a sealed load, check that you don't exceed weight limits."},{"id":"gk42","question":"How much weight can a cargo securement system be required to withstand?","choices":["Half the cargo weight","The full cargo weight","1.5 times the cargo weight","Twice the cargo weight"],"correct":0,"explanation":"Federal regulations require the aggregate working load limit of any securement system must be at least one-half (50%) of the weight of the cargo being secured."},{"id":"gk43","question":"The most important reason for doing a vehicle inspection is:","choices":["To avoid getting a ticket","Safety","To save money on repairs","It's required by law"],"correct":1,"explanation":"The most important reason for a vehicle inspection is safety - to find problems before they cause a crash or breakdown."},{"id":"gk44","question":"What are three things you check during a pre-trip inspection of the engine compartment?","choices":["Radio, heater, air freshener","Oil level, coolant level, power steering fluid","Seat position, mirror adjustment, seatbelt","Tire pressure, tire tread, wheel nuts"],"correct":1,"explanation":"In the engine compartment, check oil level, coolant level, and power steering fluid among other things."},{"id":"gk45","question":"What lights must you check during a vehicle inspection?","choices":["Dome lights only","Headlights and all other lights and reflectors","Emergency flashers only","Turn signals only"],"correct":1,"explanation":"Check headlights, tail lights, brake lights, turn signals, clearance lights, and all reflectors."},{"id":"gk46","question":"When is it acceptable to exceed the speed limit?","choices":["When passing another vehicle","Never","When traffic flow requires it","During emergencies only"],"correct":1,"explanation":"Never exceed the speed limit. Obey speed limits - they are set for ideal conditions."},{"id":"gk47","question":"What color are the parking brake controls on newer vehicles with air brakes?","choices":["Red","Blue","Yellow","Green"],"correct":2,"explanation":"In newer vehicles with air brakes, the parking brakes are controlled using a diamond-shaped, yellow, push-pull control knob."},{"id":"gk48","question":"When must you use your headlights?","choices":["Only at night","At night and any time you cannot see clearly ahead","Only when it's raining","When you feel it's necessary"],"correct":1,"explanation":"Use headlights at night and any time visibility is reduced (fog, rain, snow). Low beams let you see about 250 feet ahead; high beams about 350-500 feet."},{"id":"gk49","question":"What does GCWR stand for?","choices":["Gross Cargo Weight Rating","Gross Combination Weight Rating","General Commercial Weight Requirement","Government Commercial Weight Regulation"],"correct":1,"explanation":"GCWR stands for Gross Combination Weight Rating - the value specified by the manufacturer as the loaded weight of a combination vehicle."},{"id":"gk50","question":"What does GVWR stand for?","choices":["Gross Vehicle Weight Rating","General Vehicle Weight Requirement","Gross Volume Weight Rating","Government Vehicle Weight Regulation"],"correct":0,"explanation":"GVWR stands for Gross Vehicle Weight Rating - the value specified by the manufacturer as the loaded weight of a single vehicle."}]},"airBrakes":{"name":"Air Brakes","requiredScore":80,"questionCount":25,"questions":[{"id":"ab1","question":"The air compressor governor cut-out is typically at what pressure?","choices":["100 psi","125 psi","150 psi","80 psi"],"correct":1,"explanation":"When air tank pressure rises to the 'cut-out' level (around 125 psi), the governor stops the compressor from pumping air."},{"id":"ab2","question":"The air compressor governor cut-in is typically at what pressure?","choices":["125 psi","100 psi","55 psi","80 psi"],"correct":1,"explanation":"When the tank pressure falls to the 'cut-in' pressure (around 100 psi), the governor allows the compressor to start pumping again."},{"id":"ab3","question":"At what pressure does the safety relief valve typically open?","choices":["100 psi","125 psi","150 psi","175 psi"],"correct":2,"explanation":"The safety valve is usually set to open at 150 psi to protect the tank and system from too much pressure."},{"id":"ab4","question":"The low air pressure warning signal must come on before pressure drops below:","choices":["100 psi","80 psi","55 psi","40 psi"],"correct":2,"explanation":"A warning signal you can see must come on before the air pressure in the tanks falls below 55 psi."},{"id":"ab5","question":"Spring brakes on trucks and tractors typically come fully on when air pressure drops to:","choices":["55 psi","20 to 45 psi","80 psi","10 psi"],"correct":1,"explanation":"Tractor and straight truck spring brakes will come fully on when air pressure drops to a range of 20 to 45 psi (typically 20 to 30 psi)."},{"id":"ab6","question":"What is the maximum air leakage rate for a single vehicle with the parking brake released?","choices":["1 psi in one minute","2 psi in one minute","3 psi in one minute","4 psi in one minute"],"correct":1,"explanation":"The loss rate should be less than two psi in one minute for single vehicles."},{"id":"ab7","question":"What is the maximum air leakage rate for a combination vehicle with the parking brake released?","choices":["2 psi in one minute","3 psi in one minute","4 psi in one minute","5 psi in one minute"],"correct":1,"explanation":"The loss rate should be less than three psi in one minute for combination vehicles."},{"id":"ab8","question":"What is the maximum air leakage rate for a single vehicle with the brake pedal applied?","choices":["2 psi in one minute","3 psi in one minute","4 psi in one minute","5 psi in one minute"],"correct":1,"explanation":"With the brake applied, air pressure should not drop more than three pounds in one minute for single vehicles."},{"id":"ab9","question":"What is the maximum air leakage rate for a combination vehicle with the brake pedal applied?","choices":["3 psi in one minute","4 psi in one minute","5 psi in one minute","6 psi in one minute"],"correct":1,"explanation":"With the brake applied, air pressure should not drop more than four pounds in one minute for combination vehicles."},{"id":"ab10","question":"Air brake lag distance at 55 mph adds approximately how many feet to stopping distance?","choices":["10 feet","20 feet","32 feet","50 feet"],"correct":2,"explanation":"The air brake lag distance at 55 mph on dry pavement adds about 32 feet."},{"id":"ab11","question":"At 55 mph on dry pavement, the total stopping distance for a vehicle with air brakes is approximately:","choices":["300 feet","400 feet","Over 450 feet","200 feet"],"correct":2,"explanation":"At 55 mph for an average driver under good traction and brake conditions, the total stopping distance is over 450 feet."},{"id":"ab12","question":"What are the three braking systems in air brakes?","choices":["Primary, secondary, and auxiliary","Service, parking, and emergency","Front, rear, and trailer","Manual, automatic, and hydraulic"],"correct":1,"explanation":"Air brakes are really three different braking systems: service brake, parking brake, and emergency brake."},{"id":"ab13","question":"Why must air tanks be drained?","choices":["To check for leaks","To remove water and oil that collects","To reduce air pressure","To clean the tanks"],"correct":1,"explanation":"Compressed air usually has some water and compressor oil in it, which can cause brake failure (water can freeze in cold weather)."},{"id":"ab14","question":"If your vehicle does not have automatic air tank drains, when should you drain the tanks?","choices":["Once a week","At the end of each day of driving","Once a month","Only when moisture is visible"],"correct":1,"explanation":"If your vehicle doesn't have automatic drains, drain your air tanks at the end of each working day."},{"id":"ab15","question":"What is the most common type of foundation brake used on heavy vehicles?","choices":["Disc brakes","Wedge brakes","S-cam drum brakes","Hydraulic brakes"],"correct":2,"explanation":"The most common type of foundation brake is the s-cam drum brake."},{"id":"ab16","question":"What does ABS stand for?","choices":["Air Brake System","Antilock Braking System","Automatic Brake System","Advanced Brake Safety"],"correct":1,"explanation":"ABS stands for Antilock Braking System - a computerized system that keeps your wheels from locking up during hard brake applications."},{"id":"ab17","question":"Truck tractors with air brakes built after what date are required to have ABS?","choices":["January 1, 1996","March 1, 1997","March 1, 1998","January 1, 2000"],"correct":1,"explanation":"Truck tractors with air brakes built on or after March 1, 1997 are required to be equipped with antilock brakes."},{"id":"ab18","question":"Other air brake vehicles (trucks, buses, trailers, dollies) built after what date must have ABS?","choices":["March 1, 1997","March 1, 1998","January 1, 1999","January 1, 2000"],"correct":1,"explanation":"Other air brake vehicles built on or after March 1, 1998 are required to be equipped with antilock brakes."},{"id":"ab19","question":"What color is the ABS malfunction lamp?","choices":["Red","Yellow","Green","Blue"],"correct":1,"explanation":"Vehicles with ABS have yellow malfunction lamps to tell you if something isn't working."},{"id":"ab20","question":"When air pressure builds from 85 to 100 psi in dual air systems, it should take no longer than:","choices":["30 seconds","45 seconds","60 seconds","90 seconds"],"correct":1,"explanation":"When the engine is at operating rpms, the pressure should build from 85 to 100 psi within 45 seconds in dual air systems."},{"id":"ab21","question":"If a slack adjuster moves more than about how much when pulled, it probably needs adjustment?","choices":["Half inch","One inch","Two inches","Three inches"],"correct":1,"explanation":"If a slack adjuster moves more than about one inch where the push rod attaches to it, it probably needs adjustment."},{"id":"ab22","question":"What is the most common problem found in roadside inspections related to air brakes?","choices":["Leaking air lines","Low air pressure","Out-of-adjustment brakes","Worn brake pads"],"correct":2,"explanation":"Out-of-adjustment brakes are the most common problem found in roadside inspections."},{"id":"ab23","question":"What should you do if the low air pressure warning comes on while driving?","choices":["Continue driving but avoid hills","Pump the brakes to build pressure","Stop and safely park as soon as possible","Drive faster to build pressure"],"correct":2,"explanation":"If the low air pressure warning comes on, stop and safely park your vehicle as soon as possible."},{"id":"ab24","question":"What shape is the parking brake control knob on newer air brake vehicles?","choices":["Round","Square","Diamond-shaped","Triangle"],"correct":2,"explanation":"In newer vehicles with air brakes, you put on the parking brakes using a diamond-shaped, yellow, push-pull control knob."},{"id":"ab25","question":"How long does air brake lag take (the time for brakes to work after pushing the pedal)?","choices":["Instantly","One half second or more","Two to three seconds","Five seconds"],"correct":1,"explanation":"With air brakes, it takes a little time (one half second or more) for the air to flow through the lines to the brakes."}]},"passenger":{"name":"Passenger Endorsement","requiredScore":80,"questionCount":20,"questions":[{"id":"pe1","question":"A CDL with passenger endorsement is required when operating a vehicle designed to transport how many passengers (including the driver)?","choices":["10 or more","12 or more","16 or more","20 or more"],"correct":2,"explanation":"Bus drivers must have a CDL if they drive a vehicle designed to seat 16 or more persons, including the driver."},{"id":"pe2","question":"What emergency equipment must a bus have?","choices":["Fire extinguisher only","Fire extinguisher and emergency reflectors, plus spare fuses","Emergency reflectors only","First aid kit only"],"correct":1,"explanation":"A bus must have a fire extinguisher and emergency reflectors (3 reflective triangles or at least 6 fusees or 3 liquid burning flares), plus spare electrical fuses unless equipped with circuit breakers."},{"id":"pe3","question":"How many reflective triangles are required as emergency equipment?","choices":["2","3","4","5"],"correct":1,"explanation":"The bus must have 3 reflective triangles (or at least 6 fusees or 3 liquid burning flares)."},{"id":"pe4","question":"Where should standing passengers stay on a bus?","choices":["Anywhere they can find room","Behind the standee line","Near the driver for safety","In the front half of the bus"],"correct":1,"explanation":"No rider may stand forward of the rear of the driver's seat. All standing riders must stay behind the standee line."},{"id":"pe5","question":"How wide is the standee line on a bus floor?","choices":["1 inch","2 inches","3 inches","4 inches"],"correct":1,"explanation":"Buses designed to allow standing must have a two-inch line on the floor showing riders where they cannot stand."},{"id":"pe6","question":"What is the maximum total weight of hazardous materials that can be carried on a bus?","choices":["100 pounds","250 pounds","500 pounds","1000 pounds"],"correct":2,"explanation":"Buses can carry no more than 500 pounds total of allowed hazardous materials."},{"id":"pe7","question":"What is the maximum weight of any one class of hazardous material on a bus?","choices":["50 pounds","100 pounds","200 pounds","250 pounds"],"correct":1,"explanation":"No more than 100 pounds of any one class of hazardous material may be carried on a bus."},{"id":"pe8","question":"How far from railroad crossings should a bus stop?","choices":["5 to 25 feet","10 to 40 feet","15 to 50 feet","25 to 75 feet"],"correct":2,"explanation":"Stop your bus between 15 and 50 feet before railroad crossings."},{"id":"pe9","question":"At a drawbridge, how far back should you stop when there is no signal or attendant?","choices":["25 feet","50 feet","75 feet","100 feet"],"correct":1,"explanation":"Stop at least 50 feet before the draw of the bridge."},{"id":"pe10","question":"What type of tires are prohibited on the front wheels of a bus?","choices":["Snow tires","All-season tires","Recapped or regrooved tires","Steel-belted radials"],"correct":2,"explanation":"Front wheels must not have recapped or regrooved tires."},{"id":"pe11","question":"Which hazardous materials can NEVER be carried on a bus?","choices":["Small arms ammunition","Division 2.3 poison gas and liquid Class 6 poison","Emergency hospital supplies","ORM-D materials"],"correct":1,"explanation":"Buses must never carry Division 2.3 poison gas, liquid Class 6 poison, tear gas, or irritating materials."},{"id":"pe12","question":"When are you NOT required to stop at a railroad crossing in a bus?","choices":["When in a hurry","When the traffic signal is green or a flagman directs you","When you can see no trains coming","You must always stop"],"correct":1,"explanation":"You do not have to stop, but must slow down and carefully check, when a traffic signal is green or a policeman/flagman is directing traffic."},{"id":"pe13","question":"When crossing railroad tracks in a bus with a manual transmission, you should:","choices":["Shift into a higher gear for speed","Never change gears while crossing","Coast across in neutral","Stop on the tracks if traffic ahead stops"],"correct":1,"explanation":"If your bus has a manual transmission, never change gears while crossing the tracks."},{"id":"pe14","question":"What should you do before starting the bus after passengers have boarded?","choices":["Nothing special","Wait for them to sit down or brace themselves","Start moving slowly","Open all doors"],"correct":1,"explanation":"Wait for passengers to sit down or brace themselves before starting. Starting and stopping should be smooth."},{"id":"pe15","question":"Where should you discharge a disruptive passenger?","choices":["Wherever they want","At a safe location, not where it would be unsafe for them","At the nearest intersection","Immediately at the next stop"],"correct":1,"explanation":"Don't discharge disruptive riders where it would be unsafe for them. It may be safer at the next scheduled stop or a well-lighted area where there are other people."},{"id":"pe16","question":"Which of the following is a 'prohibited practice' for bus drivers?","choices":["Using mirrors frequently","Making announcements at stops","Fueling with passengers on board in a closed building","Using the air conditioning"],"correct":2,"explanation":"Never refuel in a closed building with riders on board."},{"id":"pe17","question":"When can you tow or push a disabled bus with passengers aboard?","choices":["Never","Only to the nearest safe spot to let passengers off","Anytime if necessary","Only in emergencies approved by dispatch"],"correct":1,"explanation":"Do not tow or push a disabled bus with riders aboard unless getting off would be unsafe. Only tow or push to the nearest safe spot to discharge passengers."},{"id":"pe18","question":"What is the brake-door interlock system?","choices":["A lock that prevents door opening","A system that applies brakes and holds throttle at idle when rear door is open","An alarm when doors are open","A backup brake system"],"correct":1,"explanation":"The brake-door interlock applies the brakes and holds the throttle in idle position when the rear door is open."},{"id":"pe19","question":"Should you use the brake-door interlock in place of the parking brake?","choices":["Yes, it's designed for that purpose","No, do not use it in place of the parking brake","Only when parked on level ground","Only when loading passengers"],"correct":1,"explanation":"Do not use the brake-door interlock safety feature in place of the parking brake."},{"id":"pe20","question":"What should you announce when arriving at a destination?","choices":["Only the location","Location, reason for stopping, next departure time, and bus number","Only departure time","Nothing unless passengers ask"],"correct":1,"explanation":"When arriving at the destination or intermediate stops, announce: the location, reason for stopping, next departure time, and bus number."}]},"schoolBus":{"name":"School Bus Endorsement","requiredScore":80,"questionCount":20,"questions":[{"id":"sb1","question":"The danger zone around a school bus can extend as much as how many feet from the front bumper?","choices":["10 feet","20 feet","30 feet","40 feet"],"correct":2,"explanation":"The danger zones may extend as much as 30 feet from the front bumper, with the first 10 feet being the most dangerous."},{"id":"sb2","question":"The danger zone extends how many feet to the left and right sides of the bus?","choices":["5 feet","10 feet","15 feet","20 feet"],"correct":1,"explanation":"The danger zone extends 10 feet from the left and right sides of the bus."},{"id":"sb3","question":"The danger zone extends how many feet behind the rear bumper?","choices":["5 feet","10 feet","20 feet","30 feet"],"correct":1,"explanation":"The danger zone extends 10 feet behind the rear bumper of the school bus."},{"id":"sb4","question":"When approaching a school bus stop, you should activate alternating amber warning lights at least how many feet before the stop?","choices":["100 feet","150 feet","200 feet","300 feet"],"correct":2,"explanation":"Activate alternating flashing amber warning lights at least 200 feet or approximately 5-10 seconds before the school bus stop."},{"id":"sb5","question":"When stopping to pick up students, the front bumper should be at least how far from students at the stop?","choices":["5 feet","10 feet","15 feet","20 feet"],"correct":1,"explanation":"Bring school bus to a full stop with the front bumper at least 10 feet away from students at the designated stop."},{"id":"sb6","question":"After unloading, students should walk at least how far from the side of the bus?","choices":["5 feet","10 feet","15 feet","20 feet"],"correct":1,"explanation":"Tell students to exit the bus and walk at least 10 feet away from the side of the bus."},{"id":"sb7","question":"How far should the outside flat mirrors let you see behind the bus?","choices":["100 feet or 2 bus lengths","200 feet or 4 bus lengths","300 feet or 6 bus lengths","50 feet or 1 bus length"],"correct":1,"explanation":"Ensure flat mirrors are adjusted so you can see 200 feet or 4 bus lengths behind the bus."},{"id":"sb8","question":"What should students do if they drop something near the bus?","choices":["Pick it up quickly","Leave it and move to safety, then get driver's attention","Ask another student to get it","Ignore it"],"correct":1,"explanation":"Students should leave any dropped object and move to a point of safety out of the danger zones and attempt to get the driver's attention to retrieve the object."},{"id":"sb9","question":"During mandatory evacuations, where should students be led to if there is a fire on the bus?","choices":["Downwind of the bus","Upwind of the bus","Behind the bus","In front of the bus"],"correct":1,"explanation":"Lead students upwind of the bus if fire is present."},{"id":"sb10","question":"If there is a risk from hazardous materials during evacuation, students should be led at least how far away?","choices":["100 feet","200 feet","300 feet","500 feet"],"correct":2,"explanation":"Lead students upwind of the bus at least 300 feet if there is a risk from spilled hazardous materials."},{"id":"sb11","question":"A safe place for evacuation should be at least how far off the road?","choices":["50 feet","100 feet","150 feet","200 feet"],"correct":1,"explanation":"A safe place will be at least 100 feet off the road in the direction of oncoming traffic."},{"id":"sb12","question":"At a railroad crossing, how far from the nearest rail should a school bus stop?","choices":["5 to 25 feet","10 to 40 feet","15 to 50 feet","25 to 75 feet"],"correct":2,"explanation":"Stop no closer than 15 feet and no farther than 50 feet from the nearest rail."},{"id":"sb13","question":"When crossing railroad tracks in a school bus, you should:","choices":["Cross quickly in a high gear","Cross in a low gear and do not change gears while crossing","Stop in the middle to check for trains","Cross in neutral to save fuel"],"correct":1,"explanation":"Cross the tracks in a low gear. Do not change gears while crossing."},{"id":"sb14","question":"If the gate comes down after you have started crossing the tracks, what should you do?","choices":["Stop immediately","Back up quickly","Drive through the gate even if you break it","Wait for it to rise"],"correct":2,"explanation":"If the gate comes down after you have started across, drive through it even if it means you will break the gate."},{"id":"sb15","question":"What is a passive railroad crossing?","choices":["A crossing with flashing lights","A crossing with gates","A crossing without any traffic control device","An abandoned crossing"],"correct":2,"explanation":"A passive crossing does not have any type of traffic control device - no flashing lights, bells, or gates."},{"id":"sb16","question":"How much tail swing can a school bus have?","choices":["Up to 1 foot","Up to 2 feet","Up to 3 feet","Up to 4 feet"],"correct":2,"explanation":"A school bus can have up to a three-foot tail swing."},{"id":"sb17","question":"When must you evacuate a school bus?","choices":["Only if students request it","When the bus is on fire or stalled on railroad tracks","Only in severe weather","Whenever you stop for more than 5 minutes"],"correct":1,"explanation":"You must evacuate when the bus is on fire or there is threat of fire, or when stalled on or adjacent to a railroad-highway crossing."},{"id":"sb18","question":"Hydraulically braked school buses with a GVWR of 10,000 lbs or more must have ABS if built on or after:","choices":["March 1, 1997","March 1, 1998","March 1, 1999","January 1, 2000"],"correct":2,"explanation":"Hydraulically braked trucks and buses with a GVWR of 10,000 lbs or more built on or after March 1, 1999 are required to have ABS."},{"id":"sb19","question":"If backing a school bus is unavoidable, when should students be picked up?","choices":["After backing","Before backing","During backing with a spotter","Students should not be on the route if backing is needed"],"correct":1,"explanation":"If you must back-up at a student pick-up point, be sure to pick up students before backing."},{"id":"sb20","question":"How far in front of the bus should students walk before crossing the roadway?","choices":["5 feet","10 feet from the right front bumper","15 feet","20 feet"],"correct":1,"explanation":"Students should walk to a location at least 10 feet in front of the right corner of the bumper, but still remaining away from the front of the school bus."}]},"vehicleInspection":{"name":"Pre-Trip Inspection","requiredScore":80,"questionCount":30,"questions":[{"id":"vi1","question":"When checking belts during a pre-trip inspection, how much play should they have at the center?","choices":["1/4 to 1/2 inch","1/2 to 3/4 inch","1 to 1-1/2 inches","No play at all"],"correct":1,"explanation":"Check belts for snugness - they should have 1/2 to 3/4 inch play at the center of the belt."},{"id":"vi2","question":"The air compressor governor cut-out should occur at approximately what pressure?","choices":["80-100 psi","100-120 psi","120-140 psi","140-160 psi"],"correct":2,"explanation":"The air compressor builds air pressure to governor cut-out at approximately 120-140 psi or as specified by manufacturer."},{"id":"vi3","question":"During the air brake check, what is the maximum air pressure drop allowed in one minute for a single vehicle with the foot brake fully applied?","choices":["2 psi","3 psi","4 psi","5 psi"],"correct":1,"explanation":"For a single vehicle, air pressure should not drop more than 3 psi in one minute with the foot brake fully applied."},{"id":"vi4","question":"During the air brake check, what is the maximum air pressure drop allowed in one minute for a combination vehicle?","choices":["2 psi","3 psi","4 psi","5 psi"],"correct":2,"explanation":"For a combination vehicle, air pressure should not drop more than 4 psi in one minute with the foot brake fully applied."},{"id":"vi5","question":"The low air pressure warning devices must activate before air pressure drops below:","choices":["40 psi","55 psi","60 psi","70 psi"],"correct":1,"explanation":"Low air warning devices (buzzer, light, flag) should activate before air pressure drops below 55 psi."},{"id":"vi6","question":"On a tractor-trailer, the tractor protection valve and parking brake valve should close (pop out) at what air pressure range?","choices":["10-15 psi","20-45 psi","50-60 psi","55-65 psi"],"correct":1,"explanation":"At a range between 20-45 psi on a tractor-trailer combination, the tractor protection valve and parking brake valve should close (pop out)."},{"id":"vi7","question":"What is the minimum tread depth required on steering axle tires?","choices":["2/32 inch","4/32 inch","6/32 inch","8/32 inch"],"correct":1,"explanation":"Steering axle tires require a minimum tread depth of 4/32 inch."},{"id":"vi8","question":"What is the minimum tread depth required on all non-steering tires?","choices":["2/32 inch","4/32 inch","6/32 inch","1/32 inch"],"correct":0,"explanation":"All non-steering tires require a minimum tread depth of 2/32 inch."},{"id":"vi9","question":"For manual slack adjusters, how far should the brake pushrod move when pulled by hand (with brakes released)?","choices":["No more than 1/2 inch","No more than 1 inch","No more than 2 inches","No more than 3 inches"],"correct":1,"explanation":"For manual slack adjusters, the brake pushrod should not move more than one inch when pulled by hand with brakes released."},{"id":"vi10","question":"When performing the hydraulic brake check, how many times should you pump the brake pedal before holding it down?","choices":["One time","Two times","Three times","Five times"],"correct":2,"explanation":"Pump the brake pedal three times, then hold it down for five seconds. The pedal should not move during those five seconds."},{"id":"vi11","question":"When holding the hydraulic brake pedal down for the brake check, how long should you hold it?","choices":["3 seconds","5 seconds","10 seconds","15 seconds"],"correct":1,"explanation":"After pumping three times, hold the brake pedal down for five seconds. It should not move (depress) during this time."},{"id":"vi12","question":"What speed should you travel when performing the service brake check?","choices":["2 mph","5 mph","10 mph","15 mph"],"correct":1,"explanation":"Pull forward at 5 mph, apply the service brake and stop to check that the vehicle stops properly and doesn't pull to either side."},{"id":"vi13","question":"What emergency equipment is required on all commercial vehicles?","choices":["Three red triangles only","Fire extinguisher only","Three red triangles, 6 fusees or 3 liquid flares, and fire extinguisher","First aid kit and fire extinguisher"],"correct":2,"explanation":"Required emergency equipment includes three red reflective triangles, 6 fusees or 3 liquid burning flares, and a properly charged fire extinguisher."},{"id":"vi14","question":"When should you check the engine oil level?","choices":["When the engine is running","When the engine is off","Either running or off","Only when the engine is warm"],"correct":1,"explanation":"Check oil level when the engine is off. The oil level must be above the refill mark."},{"id":"vi15","question":"What is the proper procedure for a safe start?","choices":["Start engine with vehicle in gear","Place gearshift in neutral (or park), depress clutch before starting","Start engine while pressing accelerator","No special procedure needed"],"correct":1,"explanation":"For a safe start, place gearshift in neutral (or park for automatics), depress clutch before starting, and release clutch slowly after engine reaches idle."},{"id":"vi16","question":"How do you check the parking brake during a pre-trip inspection?","choices":["Simply engage it and walk away","With air built up and parking brake engaged, gently try to pull forward","Press the brake pedal while in park","No check is required"],"correct":1,"explanation":"With air pressure built to governor cutout and parking brake engaged, check that it holds by gently trying to pull forward."},{"id":"vi17","question":"What color should clearance lights be on the rear of the vehicle?","choices":["Amber","White","Red","Yellow"],"correct":2,"explanation":"Clearance lights should be red on the rear and amber elsewhere on the vehicle."},{"id":"vi18","question":"What color should reflectors be on the rear of the vehicle?","choices":["Amber","White","Red","Clear"],"correct":2,"explanation":"Reflectors should be red on the rear and amber elsewhere on the vehicle."},{"id":"vi19","question":"When inspecting the steering linkage, what should you check?","choices":["Only the steering wheel","Links, arms, rods, joints, and sockets for wear, cracks, or looseness","Only the power steering fluid","Just the steering box"],"correct":1,"explanation":"Check that connecting links, arms, and rods are not worn or cracked. Joints and sockets should not be worn or loose, with no missing nuts, bolts, or cotter keys."},{"id":"vi20","question":"What should you look for when inspecting leaf springs?","choices":["Missing, shifted, cracked, or broken springs","Only broken springs","Spring color","Number of leaves only"],"correct":0,"explanation":"Look for missing, shifted, cracked, or broken leaf springs during the suspension inspection."},{"id":"vi21","question":"What are lug nuts signs of looseness?","choices":["Shiny paint","Rust trails or shiny threads","Clean appearance","Tight fitting"],"correct":1,"explanation":"Signs of loose lug nuts include rust trails or shiny threads. All lug nuts must be present and free of cracks and distortions."},{"id":"vi22","question":"What should you check on the fifth wheel skid plate?","choices":["Color only","Proper lubrication and secure mounting","Size only","Nothing - it doesn't need inspection"],"correct":1,"explanation":"Check that the fifth wheel skid plate has proper lubrication and is securely mounted with all bolts and pins secure."},{"id":"vi23","question":"When checking the coupling, what should you verify about the locking jaws?","choices":["They are painted","They are fully closed around the kingpin","They are open","They are loose"],"correct":1,"explanation":"Look into the fifth wheel gap and check that locking jaws are fully closed around the kingpin."},{"id":"vi24","question":"What should be checked regarding the trailer and fifth wheel connection?","choices":["The trailer should have a gap above the fifth wheel","The trailer should be lying flat on the fifth wheel (no gap)","The gap doesn't matter","Only check if there's noise"],"correct":1,"explanation":"Check that the trailer is lying flat on the fifth wheel skid plate with no gap."},{"id":"vi25","question":"On school buses, what additional emergency equipment must be inspected?","choices":["Extra fuel","Emergency kit and body fluid cleanup kit","Spare tire","Extra mirrors"],"correct":1,"explanation":"School bus drivers must also inspect the emergency kit and body fluid cleanup kit in addition to standard emergency equipment."},{"id":"vi26","question":"What must school bus drivers check regarding the stop arm?","choices":["Color only","That it is mounted securely and extends fully when operated","Nothing special","Only the lights"],"correct":1,"explanation":"Check that the stop arm is mounted securely to the frame, check for loose fittings and damage, and verify it extends fully when operated."},{"id":"vi27","question":"What should you verify about school bus emergency exits?","choices":["They are locked at all times","They operate smoothly, close securely, and warning devices work","They only open from outside","They don't need checking"],"correct":1,"explanation":"Demonstrate that emergency exits are not damaged, operate smoothly, close securely, and that emergency exit warning devices are working properly."},{"id":"vi28","question":"When checking brake drums, what should you look for?","choices":["Cracks, dents, holes, loose bolts, and contaminants like debris or oil","Only cracks","Nothing - drums don't need inspection","Only the color"],"correct":0,"explanation":"Check brake drums for cracks, dents, or holes, loose or missing bolts, and contaminants such as debris or oil/grease."},{"id":"vi29","question":"What is the correct way to check tire inflation during a pre-trip?","choices":["Kick the tires","Use a mallet","Use a tire gauge","Visual inspection only"],"correct":2,"explanation":"Check for proper inflation by using a tire gauge. You will not get credit for simply kicking the tires or using a mallet."},{"id":"vi30","question":"What happens if you fail to perform all three components of the air brake check?","choices":["You lose 5 points","You get a warning","Automatic failure of the vehicle inspection test","Nothing - it's optional"],"correct":2,"explanation":"Failure to perform all three components of the air brake check correctly will result in an automatic failure of the vehicle inspection test."}]},"combinationVehicles":{"name":"Combination Vehicles","requiredScore":80,"questionCount":25,"questions":[{"id":"cv1","question":"Fully loaded rigs are how many times more likely to roll over than empty rigs?","choices":["2 times","5 times","10 times","15 times"],"correct":2,"explanation":"Fully loaded rigs are ten times more likely to roll over in a crash than empty rigs because cargo raises the center of gravity."},{"id":"cv2","question":"What two things help prevent rollover in combination vehicles?","choices":["Drive fast, keep cargo high","Keep cargo low and centered, drive slowly around turns","Use trailer hand brake, accelerate through turns","Keep cargo to one side, use high gear"],"correct":1,"explanation":"Keep cargo as close to the ground as possible and centered, and drive slowly around turns to prevent rollover."},{"id":"cv3","question":"What is 'rearward amplification' also known as?","choices":["Jackknifing","Off-tracking","Crack-the-whip effect","Trailer swing"],"correct":2,"explanation":"Rearward amplification causes the crack-the-whip effect. Quick lane changes can cause the rear trailer to turn over."},{"id":"cv4","question":"In triples, the rearward amplification factor is:","choices":["1.5","2.0","3.5","5.0"],"correct":2,"explanation":"Triples have a rearward amplification of 3.5, meaning you can roll the last trailer 3.5 times as easily as a five-axle tractor."},{"id":"cv5","question":"When pulling doubles, which trailer is most likely to turn over in a quick lane change?","choices":["The front trailer","The rear trailer","Both equally","Neither - doubles are stable"],"correct":1,"explanation":"Due to the crack-the-whip effect (rearward amplification), the rear trailer is most likely to turn over in a quick lane change."},{"id":"cv6","question":"What is 'off-tracking' (also called 'cheating')?","choices":["When brakes fail","When rear wheels follow a different path than front wheels in turns","When trailer disconnects","When tires lose traction"],"correct":1,"explanation":"Off-tracking is when rear wheels follow a different path than front wheels during turns. Longer vehicles off-track more."},{"id":"cv7","question":"A 'bobtail' tractor (without trailer) compared to a fully loaded tractor-trailer:","choices":["Stops more quickly","Takes longer to stop","Stops the same","Cannot be driven"],"correct":1,"explanation":"Bobtails can be very hard to stop smoothly. They take longer to stop than a tractor-semitrailer loaded to maximum gross weight."},{"id":"cv8","question":"When should you use the trailer hand valve (trolley valve)?","choices":["For normal braking","Only to test trailer brakes","To prevent jackknifing","For parking"],"correct":1,"explanation":"The trailer hand valve should only be used to test the trailer brakes. Using it while driving can cause the trailer to skid."},{"id":"cv9","question":"Why should you NEVER use the trailer hand brake to straighten out a jackknifing trailer?","choices":["It doesn't work fast enough","The trailer brakes caused the skid in the first place","It will damage the brakes","It only works when parked"],"correct":1,"explanation":"Don't use the trailer hand brake to straighten a jackknife because the brakes on the trailer wheels caused the skid in the first place."},{"id":"cv10","question":"How do you stop a trailer skid?","choices":["Apply more brakes","Release the brakes to regain traction","Turn sharply","Accelerate"],"correct":1,"explanation":"To stop a trailer skid, release the brakes to get traction back. Once the trailer wheels grip the road, the trailer will straighten out."},{"id":"cv11","question":"The trailer air supply control on newer vehicles is what shape and color?","choices":["Round and yellow","Square and blue","Red eight-sided knob","Diamond-shaped and green"],"correct":2,"explanation":"The trailer air supply control on newer vehicles is a red eight-sided knob used to control the tractor protection valve."},{"id":"cv12","question":"What are the two air lines that connect the tractor to the trailer?","choices":["Primary and secondary","Front and rear","Service line and emergency line","Supply and return"],"correct":2,"explanation":"Every combination vehicle has two air lines: the service line (control line) and the emergency line (supply line)."},{"id":"cv13","question":"What color are service line glad hands typically coded?","choices":["Red","Blue","Yellow","Green"],"correct":1,"explanation":"Service lines are often coded blue, while emergency (supply) lines are coded red to prevent mixing them up."},{"id":"cv14","question":"What happens if you cross the air lines when coupling?","choices":["Nothing - they work the same","The trailer brakes won't release","The tractor brakes fail","The horn won't work"],"correct":1,"explanation":"If you cross air lines, air won't charge the trailer tanks and the spring brakes won't release. You could drive away without trailer brakes."},{"id":"cv15","question":"On trailers without spring brakes (built before 1975), what should you always use when parking?","choices":["The trailer hand valve","Wheel chocks","The emergency brake only","Nothing special needed"],"correct":1,"explanation":"Trailers without spring brakes need wheel chocks when parked because air can leak away leaving no brakes."},{"id":"cv16","question":"Where are shut-off valves located on combination vehicles?","choices":["Only on the tractor","At the back of trailers used to tow other trailers","On the front of each trailer","Inside the cab only"],"correct":1,"explanation":"Shut-off valves are at the back of trailers used to tow other trailers. They permit closing air lines when another trailer isn't being towed."},{"id":"cv17","question":"When towing multiple trailers, which shut-off valves should be closed?","choices":["All of them","None of them","Only the ones at the back of the last trailer","Only the front trailer's valves"],"correct":2,"explanation":"All shut-off valves should be open except the ones at the back of the last trailer, which must be closed."},{"id":"cv18","question":"All trailers and converter dollies built on or after what date must have ABS?","choices":["March 1, 1997","March 1, 1998","January 1, 1999","January 1, 2000"],"correct":1,"explanation":"All trailers and converter dollies built on or after March 1, 1998 are required to have ABS."},{"id":"cv19","question":"When coupling, what should the trailer height be?","choices":["Higher than the fifth wheel","Low enough to be raised slightly when tractor backs under","Exactly level with fifth wheel","As low as possible"],"correct":1,"explanation":"The trailer should be low enough that it is raised slightly by the tractor when backing under. Too low damages the nose; too high may not couple correctly."},{"id":"cv20","question":"After coupling, how much space should there be between the upper and lower fifth wheel?","choices":["About 1 inch","About 2 inches","No space at all","3-4 inches"],"correct":2,"explanation":"There should be no space between upper and lower fifth wheel. If there is space, the kingpin may be on top of closed jaws and the trailer could come loose."},{"id":"cv21","question":"When inspecting the coupling, the locking jaws should be around what part of the kingpin?","choices":["The head","The shank","The base","Any part is fine"],"correct":1,"explanation":"The locking jaws must be around the shank of the kingpin, not the head. If around the head, the trailer could come loose."},{"id":"cv22","question":"Why must the fifth wheel be properly greased?","choices":["To prevent rust","To prevent steering problems from friction","For appearance","It's not necessary to grease it"],"correct":1,"explanation":"Failure to keep the fifth wheel plate lubricated could cause steering problems because of friction between the tractor and trailer."},{"id":"cv23","question":"When uncoupling, why should you lower the landing gear before disconnecting air lines?","choices":["To save time","The trailer could fall if landing gear collapses or sinks","Air lines are easier to reach","It's not important"],"correct":1,"explanation":"Lower landing gear first. After pulling partially clear, stop with tractor frame under trailer in case landing gear collapses or sinks."},{"id":"cv24","question":"To test that air flows to all trailers, you should open the emergency line shut-off at the rear of the last trailer and:","choices":["See if lights come on","Hear air escaping","Feel for vibration","Check the gauge only"],"correct":1,"explanation":"Open the emergency line shut-off valve at the rear of the last trailer. You should hear air escaping, showing the entire system is charged."},{"id":"cv25","question":"When backing a trailer, which way do you turn the steering wheel to make the trailer go left?","choices":["Turn left (same direction)","Turn right (opposite direction)","It doesn't matter","You can't steer while backing"],"correct":1,"explanation":"When backing a trailer, turn the steering wheel in the opposite direction you want the trailer to go. Turn right to make trailer go left."}]}};

(function() {
    'use strict';
    let state = {
        currentTest: null,
        questions: [],
        currentQuestionIndex: 0,
        answers: [],
        practiceMode: true,
        isReviewing: false
    };

    const screens = {
        home: document.getElementById('home-screen'),
        test: document.getElementById('test-screen'),
        results: document.getElementById('results-screen'),
        review: document.getElementById('review-screen')
    };

    function showScreen(screenName) {
        Object.values(screens).forEach(s => s.classList.remove('active'));
        screens[screenName].classList.add('active');
    }

    function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }

    function startTest(testType) {
        const testData = QUESTIONS_DATA[testType];
        if (!testData) return;
        state.currentTest = testType;
        state.questions = shuffleArray(testData.questions);
        state.currentQuestionIndex = 0;
        state.answers = new Array(state.questions.length).fill(null);
        state.practiceMode = document.querySelector('input[name="test-mode"]:checked').value === 'practice';
        state.isReviewing = false;
        document.getElementById('test-title').textContent = testData.name;
        showScreen('test');
        renderQuestion();
    }

    function renderQuestion() {
        const question = state.questions[state.currentQuestionIndex];
        const index = state.currentQuestionIndex;
        const total = state.questions.length;
        document.getElementById('progress').textContent = `${index + 1}/${total}`;
        document.getElementById('question-number').textContent = `Question ${index + 1}`;
        document.getElementById('progress-fill').style.width = `${((index + 1) / total) * 100}%`;
        document.getElementById('question-text').textContent = question.question;
        const choicesContainer = document.getElementById('choices');
        choicesContainer.innerHTML = '';
        const letters = ['A', 'B', 'C', 'D'];
        question.choices.forEach((choice, i) => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerHTML = `<span class="choice-letter">${letters[i]}</span><span class="choice-text">${choice}</span>`;
            const userAnswer = state.answers[index];
            const hasAnswered = userAnswer !== null;
            if (hasAnswered) {
                btn.classList.add('disabled');
                if (i === userAnswer) {
                    btn.classList.add('selected');
                    // Only show correct/incorrect in practice mode
                    if (state.practiceMode) {
                        if (i === question.correct) btn.classList.add('correct');
                        else btn.classList.add('incorrect');
                    }
                }
                // Show correct answer in practice mode
                if (state.practiceMode && i === question.correct && userAnswer !== question.correct) {
                    btn.classList.add('correct');
                }
            }
            btn.addEventListener('click', () => selectAnswer(i));
            choicesContainer.appendChild(btn);
        });
        const explanationEl = document.getElementById('explanation');
        // Only show explanation in practice mode after answering
        if (state.practiceMode && state.answers[index] !== null) {
            explanationEl.classList.remove('hidden');
            const isCorrect = state.answers[index] === question.correct;
            explanationEl.innerHTML = `<div class="explanation-title">${isCorrect ? 'Correct!' : 'Incorrect'}</div><div>${question.explanation}</div>`;
        } else {
            explanationEl.classList.add('hidden');
        }
        document.getElementById('prev-btn').disabled = index === 0;
        const nextBtn = document.getElementById('next-btn');
        nextBtn.textContent = index === total - 1 ? 'Finish Test' : 'Next';
    }

    function selectAnswer(choiceIndex) {
        const index = state.currentQuestionIndex;
        if (state.answers[index] !== null) return;
        state.answers[index] = choiceIndex;
        renderQuestion();
    }

    function nextQuestion() {
        if (state.currentQuestionIndex < state.questions.length - 1) {
            state.currentQuestionIndex++;
            renderQuestion();
        } else {
            finishTest();
        }
    }

    function prevQuestion() {
        if (state.currentQuestionIndex > 0) {
            state.currentQuestionIndex--;
            renderQuestion();
        }
    }

    function finishTest() {
        const unanswered = state.answers.filter(a => a === null).length;
        if (unanswered > 0 && !confirm(`You have ${unanswered} unanswered question(s). Finish anyway?`)) return;
        let correct = 0;
        state.questions.forEach((q, i) => { if (state.answers[i] === q.correct) correct++; });
        const total = state.questions.length;
        const percentage = Math.round((correct / total) * 100);
        const passed = percentage >= 80;
        saveStats(state.currentTest, percentage, passed);
        document.getElementById('score-percent').textContent = `${percentage}%`;
        document.getElementById('correct-count').textContent = correct;
        document.getElementById('incorrect-count').textContent = total - correct;
        const scoreCircle = document.getElementById('score-circle');
        const passFail = document.getElementById('pass-fail');
        if (passed) {
            scoreCircle.classList.remove('fail');
            passFail.className = 'pass-fail passed';
            passFail.textContent = 'PASSED';
        } else {
            scoreCircle.classList.add('fail');
            passFail.className = 'pass-fail failed';
            passFail.textContent = 'FAILED';
        }
        showScreen('results');
    }

    function reviewAnswers() {
        state.isReviewing = true;
        state.currentQuestionIndex = 0;
        showScreen('review');
        renderReviewQuestion();
    }

    function renderReviewQuestion() {
        const question = state.questions[state.currentQuestionIndex];
        const index = state.currentQuestionIndex;
        const total = state.questions.length;
        const userAnswer = state.answers[index];
        const isCorrect = userAnswer === question.correct;
        document.getElementById('review-progress').textContent = `${index + 1}/${total}`;
        document.getElementById('review-question-number').textContent = `Question ${index + 1}`;
        const statusEl = document.getElementById('review-status');
        statusEl.className = `question-status ${isCorrect ? 'correct' : 'incorrect'}`;
        statusEl.textContent = isCorrect ? 'Correct' : 'Incorrect';
        document.getElementById('review-question-text').textContent = question.question;
        const choicesContainer = document.getElementById('review-choices');
        choicesContainer.innerHTML = '';
        const letters = ['A', 'B', 'C', 'D'];
        question.choices.forEach((choice, i) => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn disabled';
            if (i === question.correct) btn.classList.add('correct');
            else if (i === userAnswer) btn.classList.add('incorrect');
            btn.innerHTML = `<span class="choice-letter">${letters[i]}</span><span class="choice-text">${choice}${i === userAnswer ? ' (Your answer)' : ''}</span>`;
            choicesContainer.appendChild(btn);
        });
        document.getElementById('review-explanation').innerHTML = `<div class="explanation-title">Explanation</div><div>${question.explanation}</div>`;
        document.getElementById('review-prev-btn').disabled = index === 0;
        document.getElementById('review-next-btn').disabled = index === total - 1;
    }

    function saveStats(testType, score, passed) {
        const stats = JSON.parse(localStorage.getItem('cdl-stats') || '{}');
        if (!stats[testType]) stats[testType] = { attempts: 0, highScore: 0, lastScore: 0, passed: 0 };
        stats[testType].attempts++;
        stats[testType].lastScore = score;
        if (score > stats[testType].highScore) stats[testType].highScore = score;
        if (passed) stats[testType].passed++;
        localStorage.setItem('cdl-stats', JSON.stringify(stats));
        loadStats();
    }

    function loadStats() {
        const stats = JSON.parse(localStorage.getItem('cdl-stats') || '{}');
        const summaryEl = document.getElementById('stats-summary');
        if (Object.keys(stats).length === 0) { summaryEl.innerHTML = ''; return; }
        const testNames = { generalKnowledge: 'General Knowledge', airBrakes: 'Air Brakes', passenger: 'Passenger', schoolBus: 'School Bus', vehicleInspection: 'Pre-Trip Inspection', combinationVehicles: 'Combination Vehicles', doublesTriples: 'Doubles/Triples', tankVehicles: 'Tank Vehicles', hazardousMaterials: 'Hazardous Materials' };
        let html = '<h3>Your Progress</h3>';
        for (const [key, data] of Object.entries(stats)) {
            html += `<div class="stat-row"><span>${testNames[key] || key}</span><span>Best: ${data.highScore}% | Last: ${data.lastScore}%</span></div>`;
        }
        summaryEl.innerHTML = html;
    }

    function init() {
        loadStats();
        document.querySelectorAll('.test-btn').forEach(btn => {
            btn.addEventListener('click', () => startTest(btn.dataset.test));
        });
        document.getElementById('back-btn').addEventListener('click', () => {
            if (confirm('Quit? Progress will be lost.')) showScreen('home');
        });
        document.getElementById('prev-btn').addEventListener('click', prevQuestion);
        document.getElementById('next-btn').addEventListener('click', nextQuestion);
        document.getElementById('review-btn').addEventListener('click', reviewAnswers);
        document.getElementById('retake-btn').addEventListener('click', () => startTest(state.currentTest));
        document.getElementById('home-btn').addEventListener('click', () => showScreen('home'));
        document.getElementById('review-back-btn').addEventListener('click', () => showScreen('results'));
        document.getElementById('review-prev-btn').addEventListener('click', () => {
            if (state.currentQuestionIndex > 0) { state.currentQuestionIndex--; renderReviewQuestion(); }
        });
        document.getElementById('review-next-btn').addEventListener('click', () => {
            if (state.currentQuestionIndex < state.questions.length - 1) { state.currentQuestionIndex++; renderReviewQuestion(); }
        });
        document.addEventListener('keydown', (e) => {
            if (screens.test.classList.contains('active')) {
                if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextQuestion(); }
                else if (e.key === 'ArrowLeft') { e.preventDefault(); prevQuestion(); }
                else if (['1','2','3','4','a','b','c','d','A','B','C','D'].includes(e.key)) {
                    e.preventDefault();
                    let idx = ['1','a','A'].includes(e.key) ? 0 : ['2','b','B'].includes(e.key) ? 1 : ['3','c','C'].includes(e.key) ? 2 : 3;
                    selectAnswer(idx);
                }
            }
        });
    }
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
    else init();
})();
</script>
</body>
</html>
